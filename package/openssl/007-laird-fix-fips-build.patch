From 6fa805f516f5a6ff3872f1d1014a3dc9de460b99 Mon Sep 17 00:00:00 2001
From: "Dr. Stephen Henson" <steve@openssl.org>
Date: Thu, 22 Jan 2015 19:43:27 +0000
Subject: [PATCH] FIPS build fixes.

PR#3673

Reviewed-by: Tim Hudson <tjh@openssl.org>
---
 crypto/ec/ec_curve.c | 8 ++++----
 crypto/ec/ec_cvt.c   | 6 +++---
 ssl/t1_lib.c         | 2 +-
 3 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/crypto/ec/ec_curve.c b/crypto/ec/ec_curve.c
index 023bd0e..6dbe9d8 100644
--- a/crypto/ec/ec_curve.c
+++ b/crypto/ec/ec_curve.c
@@ -69,16 +69,16 @@
  *
  */
 
-#ifdef OPENSSL_FIPS
-# include <openssl/fips.h>
-#endif
-
 #include <string.h>
 #include "ec_lcl.h"
 #include <openssl/err.h>
 #include <openssl/obj_mac.h>
 #include <openssl/opensslconf.h>
 
+#ifdef OPENSSL_FIPS
+# include <openssl/fips.h>
+#endif
+
 typedef struct {
     int field_type,             /* either NID_X9_62_prime_field or
                                  * NID_X9_62_characteristic_two_field */
diff --git a/crypto/ec/ec_cvt.c b/crypto/ec/ec_cvt.c
index 73cc123..5a832ba 100644
--- a/crypto/ec/ec_cvt.c
+++ b/crypto/ec/ec_cvt.c
@@ -69,13 +69,13 @@
  *
  */
 
+#include <openssl/err.h>
+#include "ec_lcl.h"
+
 #ifdef OPENSSL_FIPS
 # include <openssl/fips.h>
 #endif
 
-#include <openssl/err.h>
-#include "ec_lcl.h"
-
 EC_GROUP *EC_GROUP_new_curve_GFp(const BIGNUM *p, const BIGNUM *a,
                                  const BIGNUM *b, BN_CTX *ctx)
 {
diff --git a/ssl/t1_lib.c b/ssl/t1_lib.c
index 72be01d..90ef867 100644
--- a/ssl/t1_lib.c
+++ b/ssl/t1_lib.c
@@ -470,7 +470,7 @@ static int tls1_get_curvelist(SSL *s, int sess,
 # ifdef OPENSSL_FIPS
             if (FIPS_mode()) {
                 *pcurves = fips_curves_default;
-                *pcurveslen = sizeof(fips_curves_default);
+                pcurveslen = sizeof(fips_curves_default);
             } else
 # endif
             {
